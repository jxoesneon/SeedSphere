<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Manage your SeedSphere node, view streaming stats, and configure your P2P preferences."
    />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self' https://accounts.google.com; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com;"
    />
    <title>SeedSphere Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="dashboard.css" />
  </head>

  <body>
    <!-- Navigation -->
    <nav class="glass-nav">
      <div class="nav-container">
        <div class="logo">
          <span class="logo-symbol">üå±</span>
          <span class="logo-text">SeedSphere</span>
        </div>
        <div class="nav-links">
          <a href="index.html">Home</a>
          <a href="docs.html">Docs</a>
          <a href="#" class="user-badge">
            <span>üå±</span>
            <span id="user-id">Loading...</span>
          </a>
          <button class="btn-logout">Sign Out</button>
        </div>
      </div>
    </nav>

    <!-- Login Overlay -->
    <div id="login-overlay" class="login-overlay" style="display: none">
      <div class="login-card glass">
        <div class="login-header">
          <span class="logo-symbol">üå±</span>
          <h2>Welcome Back</h2>
          <p>Sign in to your account</p>
        </div>

        <a href="/api/auth/google/start" class="btn-login-google">
          <span class="icon">G</span>
          Continue with Google
        </a>

        <div class="divider">
          <span>OR</span>
        </div>

        <form id="magic-link-form" class="magic-form">
          <div class="form-group">
            <input
              type="email"
              id="magic-email"
              placeholder="name@example.com"
              required
            />
          </div>
          <button type="submit" class="btn-login-email">
            Continue with Email
          </button>
        </form>
        <p id="magic-status" class="status-msg"></p>
      </div>
    </div>

    <!-- Dashboard Container -->
    <div
      class="dashboard-container"
      id="main-dashboard"
      style="filter: blur(5px)"
    >
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="sidebar-nav">
          <a href="#overview" class="nav-item active">
            <span class="nav-icon">üìä</span>
            Overview
          </a>
          <a href="#downloads" class="nav-item">
            <span class="nav-icon">üì±</span>
            Downloads
          </a>
          <a href="#settings" class="nav-item">
            <span class="nav-icon">‚öôÔ∏è</span>
            Settings
          </a>
          <a href="#activity" class="nav-item">
            <span class="nav-icon">üìà</span>
            Activity
          </a>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="dashboard-main">
        <!-- Overview Section -->
        <section id="overview" class="dashboard-section">
          <h1 class="dashboard-title">Welcome Back</h1>

          <!-- Profile Card -->
          <div class="profile-card glass">
            <div class="profile-header">
              <div class="profile-avatar">üå±</div>
              <div class="profile-info">
                <h2 id="gardener-id">Gardener #####</h2>
                <p class="profile-status">
                  <span class="status-indicator active"></span>
                  Connected to Router
                </p>
              </div>
            </div>
            <div class="profile-stats">
              <div class="stat-card">
                <div class="stat-label">Nodes Discovered</div>
                <div class="stat-value" id="nodes-count">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Data Shared</div>
                <div class="stat-value" id="data-shared">0 MB</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Uptime</div>
                <div class="stat-value" id="uptime">0h</div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <h3>Quick Actions</h3>
            <div class="action-grid">
              <button class="action-card glass">
                <span class="action-icon">üîó</span>
                <span class="action-label">Link New Device</span>
              </button>
              <button class="action-card glass">
                <span class="action-icon">üîÑ</span>
                <span class="action-label">Refresh P2P Status</span>
              </button>
              <button class="action-card glass">
                <span class="action-icon">üì•</span>
                <span class="action-label">Download APK</span>
              </button>
              <button class="action-card glass">
                <span class="action-icon">üìã</span>
                <span class="action-label">View API Docs</span>
              </button>
            </div>
          </div>
        </section>

        <!-- Downloads Section -->
        <section id="downloads" class="dashboard-section" style="display: none">
          <h1 class="dashboard-title">Downloads</h1>

          <!-- Latest Release Hero -->
          <div id="latest-release-hero" class="hero-card glass" style="display: none; margin-bottom: 2rem; padding: 2.5rem; border: 1px solid rgba(255,255,255,0.1);">
            <div class="hero-content" style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 2rem;">
                <div class="hero-info" style="flex: 1; min-width: 300px;">
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <span id="hero-version" class="version-tag" style="font-size: 1.25rem; padding: 0.5rem 1rem;">v2.0.0</span>
                        <span class="status-indicator active" style="background: #4ade80; box-shadow: 0 0 10px rgba(74,222,128,0.4);"></span>
                        <span style="color: #4ade80; font-weight: 600; letter-spacing: 1px;">LATEST STABLE</span>
                    </div>
                    <h2 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; color: white;">Get SeedSphere</h2>
                    <p style="color: var(--aether-text-muted); font-size: 1.1rem; line-height: 1.6; margin-bottom: 2rem;">
                        Secure, private, and faster than ever. Download the latest version for your device.
                    </p>
                    <div style="margin-bottom: 1rem;">
                        <strong style="color: white; display: block; margin-bottom: 0.5rem;">Release Notes</strong>
                        <p id="hero-notes" style="color: rgba(255,255,255,0.6); display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;">
                            Loading notes...
                        </p>
                    </div>
                </div>

                <div class="hero-actions" style="flex: 1; min-width: 300px;">
                    <h3 style="color: white; margin-bottom: 1.5rem;">Select Platform</h3>
                    <div id="platform-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem;">
                        <!-- Buttons injected via JS -->
                    </div>
                    <div id="os-detected" style="margin-top: 1rem; font-size: 0.9rem; color: #60a5fa; display: none;">
                        ‚ú® We detected your device as <span id="user-os" style="font-weight: bold;">Unknown</span>
                    </div>
                </div>
            </div>
          </div>

          <!-- Legacy List Container -->
          <div class="download-list" id="download-list-container">
            <!-- Dynamically populated fallback or older versions -->
          </div>

          <div class="version-history">
            <h3>Version History</h3>
            <div class="history-list">
               <!-- Populated by JS -->
            </div>
          </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="dashboard-section" style="display: none">
          <h1 class="dashboard-title">Settings</h1>

          <div class="settings-card glass">
            <h3>API Credentials</h3>
            <form class="form-group" onsubmit="return false;">
              <div style="display: flex; justify-content: space-between; align-items: baseline;">
                <label for="rd-key">Real-Debrid API Key</label>
                <a href="https://real-debrid.com/apitoken" target="_blank" style="font-size: 0.8rem; color: var(--aether-blue);">Where to find this?</a>
              </div>
              <!-- Accessibility: Hidden username -->
              <input type="text" name="username" autocomplete="username" style="display: none" />
              <div class="input-wrapper" style="position: relative;">
                <input
                  type="password"
                  class="form-input"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  id="rd-key"
                  autocomplete="new-password"
                  pattern="[a-zA-Z0-9]+"
                  title="Alphanumeric characters only"
                  style="padding-right: 2.5rem;"
                />
                <button 
                    type="button" 
                    class="btn-toggle-visibility" 
                    data-target="rd-key"
                    style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: rgba(255,255,255,0.5); cursor: pointer; padding: 0.25rem;"
                >
                    üëÅÔ∏è
                </button>
              </div>
              <button class="btn-save">Save</button>
            </form>

            <form class="form-group" onsubmit="return false;">
              <div style="display: flex; justify-content: space-between; align-items: baseline;">
                <label for="ad-key">AllDebrid API Key</label>
                <a href="https://alldebrid.com/apikeys" target="_blank" style="font-size: 0.8rem; color: var(--aether-blue);">Where to find this?</a>
              </div>
              <!-- Accessibility: Hidden username -->
              <input type="text" name="username" autocomplete="username" style="display: none" />
              <div class="input-wrapper" style="position: relative;">
                <input
                  type="password"
                  class="form-input"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  id="ad-key"
                  autocomplete="new-password"
                  pattern="[a-zA-Z0-9]+"
                  title="Alphanumeric characters only"
                  style="padding-right: 2.5rem;"
                />
                <button 
                    type="button" 
                    class="btn-toggle-visibility" 
                    data-target="ad-key"
                    style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: rgba(255,255,255,0.5); cursor: pointer; padding: 0.25rem;"
                >
                    üëÅÔ∏è
                </button>
              </div>
              <button class="btn-save">Save</button>
            </form>
          </div>

          <div class="settings-card glass">
            <h3>Linking Token & Stremio Addon</h3>
            <div class="token-display">
              <code id="linking-token">Loading...</code>
              <button class="btn-copy">Copy</button>
            </div>
            <div style="margin-top: 1rem">
              <button
                class="btn-install-addon"
                style="
                  width: 100%;
                  padding: 0.75rem;
                  background: var(--aether-blue);
                  border: none;
                  border-radius: 8px;
                  color: white;
                  cursor: pointer;
                  font-weight: 600;
                "
              >
                üß© Install to Stremio
              </button>
            </div>
            <p class="help-text">
              Use this token to link devices or install the private addon.
            </p>
          </div>

          <div class="settings-card glass danger-zone">
            <h3>Danger Zone</h3>
            <button class="btn-danger">Unlink All Devices</button>
            <button class="btn-danger">Delete Account</button>
          </div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="dashboard-section" style="display: none">
          <h1 class="dashboard-title">User Profile</h1>

          <!-- Identity Card -->
          <div class="profile-header-card glass">
            <div class="user-identity">
              <div class="large-avatar">üå±</div>
              <div>
                <h2 id="profile-user-id">User</h2>
                <p id="profile-email" class="text-muted">Loading...</p>
              </div>
            </div>
          </div>

          <!-- Security Hub -->
          <div class="settings-card glass">
            <h3>Active Sessions</h3>
            <div id="sessions-list" class="sessions-list">
              <!-- Populated by JS -->
              <div class="session-item loading">Loading active sessions...</div>
            </div>
          </div>

          <!-- Integrations (Moved from Settings) -->
          <div class="settings-card glass">
            <h3>Integrations</h3>
            <p class="text-muted" style="margin-bottom: 1rem;">Manage your Debrid API keys here.</p>
            
            <form class="form-group" onsubmit="return false;">
              <label for="profile-rd-key">Real-Debrid API Key</label>
              <div class="input-wrapper">
                <input type="password" class="form-input" id="profile-rd-key" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <button class="btn-save" data-target="profile-rd-key">Save</button>
              </div>
            </form>

             <form class="form-group" onsubmit="return false;">
              <label for="profile-ad-key">AllDebrid API Key</label>
              <div class="input-wrapper">
                <input type="password" class="form-input" id="profile-ad-key" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                <button class="btn-save" data-target="profile-ad-key">Save</button>
              </div>
            </form>
          </div>

          <!-- Danger Zone -->
          <div class="settings-card glass danger-zone">
            <h3>Danger Zone</h3>
            <p class="text-muted">Once you delete your account, there is no going back. Please be certain.</p>
            <button id="btn-delete-account" class="btn-danger full-width">Delete Account</button>
          </div>
        </section>

        <!-- Activity Section -->
        <section id="activity" class="dashboard-section" style="display: none">
          <h1 class="dashboard-title">Activity Feed</h1>

          <div class="activity-feed">
            <div class="activity-item glass">
              <span class="activity-icon">üîó</span>
              <div class="activity-content">
                <strong>Device Linked</strong>
                <span class="activity-time">2 hours ago</span>
              </div>
            </div>

            <div class="activity-item glass">
              <span class="activity-icon">üì°</span>
              <div class="activity-content">
                <strong>Joined P2P Swarm</strong>
                <span class="activity-time">5 hours ago</span>
              </div>
            </div>

            <div class="activity-item glass">
              <span class="activity-icon">üå±</span>
              <div class="activity-content">
                <strong>Account Created</strong>
                <span class="activity-time">1 day ago</span>
              </div>
            </div>
          </div>
        </section>
      </main>
    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>



    <script src="dashboard.js"></script>
  </body>
</html>
